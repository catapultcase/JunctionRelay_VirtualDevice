<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>JunctionRelay Virtual Device</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      background: #111;
      color: #eaeaea;
      font-family: system-ui, Arial, sans-serif;
      padding: 24px;
    }
    #root {
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    h3 {
      margin: 0 0 12px;
      font-size: 20px;
    }
    p {
      color: #9aa0a6;
      margin: 6px 0 0;
      font-size: 14px;
    }
    button {
      padding: 10px 14px;
      cursor: pointer;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 14px;
    }
    button:hover {
      background: #444;
    }
    button.active {
      background: #007acc;
      border-color: #007acc;
    }
    button.danger {
      background: #dc3545;
      border-color: #dc3545;
    }
    select {
      padding: 10px 14px;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      min-width: 200px;
    }
    select:hover {
      background: #444;
    }
    select:focus {
      outline: none;
      border-color: #007acc;
    }
    select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #2a2a2a;
    }
    input[type="number"] {
      padding: 10px 14px;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 14px;
      width: 100px;
    }
    input[type="number"]:hover:not(:disabled) {
      background: #444;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: #007acc;
    }
    input[type="number"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #2a2a2a;
    }
    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .connection-status {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 12px 16px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .connection-status button {
      margin-left: auto;
      white-space: nowrap;
    }
    .connection-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #666;
    }
    .connection-indicator.active {
      background: #28a745;
      box-shadow: 0 0 8px #28a745;
    }
    .connection-info {
      flex: 1;
    }
    .connection-mode {
      font-size: 13px;
      color: #9aa0a6;
      margin-bottom: 2px;
    }
    .connection-address {
      font-size: 14px;
      color: #6c9bcf;
      font-weight: 500;
    }
    .settings-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 0;
      margin-top: 12px;
      overflow: hidden;
    }
    .tabs-header {
      display: flex;
      border-bottom: 1px solid #333;
      background: #151515;
    }
    .tab-btn {
      flex: 1;
      padding: 12px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #9aa0a6;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab-btn:hover {
      background: #1a1a1a;
      color: #eaeaea;
    }
    .tab-btn.active {
      color: #007acc;
      border-bottom-color: #007acc;
      background: #1a1a1a;
    }
    .tab-content {
      padding: 16px;
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .tab-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .tab-col {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .tab-col:first-child {
      padding-right: 16px;
      border-right: 1px solid #333;
    }
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .select-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .select-label {
      font-size: 14px;
      color: #9aa0a6;
    }
    .position-selector {
      display: grid;
      grid-template-columns: repeat(3, 40px);
      grid-template-rows: repeat(3, 40px);
      gap: 3px;
      margin-top: 8px;
    }
    .position-btn {
      width: 40px;
      height: 40px;
      padding: 0;
      background: #333;
      border: 2px solid #555;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #9aa0a6;
    }
    .position-btn:hover {
      background: #444;
      border-color: #666;
    }
    .position-btn.active {
      background: #007acc;
      border-color: #007acc;
      color: white;
    }
    .position-btn.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      background: #222;
    }
    #quit-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 8px 12px;
      font-size: 12px;
      z-index: 1000;
    }
    #devtools-btn {
      position: fixed;
      bottom: 20px;
      right: 90px;
      padding: 8px 12px;
      font-size: 12px;
      z-index: 1000;
      background: #555;
    }
    #devtools-btn:hover {
      background: #666;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 560px;
      background: #2d7bf4;
      color: white;
      padding: 10px 14px;
      border-radius: 6px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
      z-index: 1000;
      font-size: 13px;
      line-height: 1.35;
    }
    .toast.error {
      background: #c0392b;
    }
    .retry-fields {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .retry-fields.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="root">
    <main style="flex: 1; overflow-y: auto; overflow-x: hidden;">
      <section>
        <h3>JunctionRelay Virtual Device <span id="version-header" style="font-size: 14px; color: #9aa0a6; font-weight: normal;"></span></h3>
        <div class="button-group">
          <button id="mode-btn" class="active" onclick="app.toggleMode()">Fullscreen</button>
          <button id="viewport-btn" onclick="app.toggleViewport()">Open ViewPort</button>
        </div>

        <div class="connection-status">
          <div id="connection-indicator" class="connection-indicator"></div>
          <div class="connection-info">
            <div class="connection-mode" id="connection-mode">WebSocket</div>
            <div class="connection-address" id="connection-address">Not connected</div>
          </div>
          <button id="ws-btn" onclick="app.toggleWebSocket()">Start WebSocket Server</button>
        </div>

        <div class="settings-card">
          <div class="tabs-header">
            <button class="tab-btn active" onclick="app.switchTab('options')">Options</button>
            <button class="tab-btn" onclick="app.switchTab('connection')">Connection</button>
            <button class="tab-btn" onclick="app.switchTab('displays')">Displays</button>
          </div>

          <!-- Options Tab -->
          <div id="tab-options" class="tab-content active">
            <div class="tab-grid">
              <div class="tab-col">
                <div class="checkbox-group">
                  <label>
                    <input type="checkbox" id="hide-cursor" checked>
                    <span>Hide cursor in fullscreen mode</span>
                  </label>
                  <label>
                    <input type="checkbox" id="auto-open-viz">
                    <span>Auto-open visualization on stream detection</span>
                  </label>
                  <label>
                    <input type="checkbox" id="start-minimized">
                    <span>Start with main window minimized to tray</span>
                  </label>
                </div>
              </div>

              <div class="tab-col">
                <div class="checkbox-group">
                  <label>
                    <input type="checkbox" id="show-fps">
                    <span>Show FPS overlay in visualization</span>
                  </label>
                </div>
                <div class="select-group">
                  <span class="select-label">FPS Counter Position:</span>
                  <div class="position-selector">
                    <button class="position-btn active" data-position="top-left" onclick="app.setFpsPosition('top-left')">TL</button>
                    <button class="position-btn disabled"></button>
                    <button class="position-btn" data-position="top-right" onclick="app.setFpsPosition('top-right')">TR</button>
                    <button class="position-btn disabled"></button>
                    <button class="position-btn" data-position="center" onclick="app.setFpsPosition('center')">C</button>
                    <button class="position-btn disabled"></button>
                    <button class="position-btn" data-position="bottom-left" onclick="app.setFpsPosition('bottom-left')">BL</button>
                    <button class="position-btn disabled"></button>
                    <button class="position-btn" data-position="bottom-right" onclick="app.setFpsPosition('bottom-right')">BR</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Connection Tab -->
          <div id="tab-connection" class="tab-content">
            <div class="tab-grid">
              <div class="tab-col">
                <div class="select-group">
                  <span class="select-label">Connection Mode:</span>
                  <select id="connection-mode-select">
                    <option value="websocket">WebSocket</option>
                  </select>
                </div>

                <div class="input-group">
                  <span class="select-label">WebSocket Port:</span>
                  <input type="number" id="ws-port" min="1024" max="65535" step="1" value="8081" style="width: 150px;">
                  <p style="font-size: 12px; color: #9aa0a6; margin-top: 4px;">Port changes require restarting the WebSocket server</p>
                </div>
              </div>

              <div class="tab-col">
                <div class="checkbox-group">
                  <label>
                    <input type="checkbox" id="auto-start">
                    <span>Auto-start WebSocket server on launch</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Displays Tab -->
          <div id="tab-displays" class="tab-content">
            <div class="tab-grid">
              <div class="tab-col">
                <div class="select-group">
                  <span class="select-label">Display Monitor:</span>
                  <select id="monitor-select">
                    <option value="0">Loading displays...</option>
                  </select>
                </div>

                <div class="select-group">
                  <span class="select-label">Multi-Monitor Behavior:</span>
                  <select id="monitor-behavior-select">
                    <option value="wait">Wait for set display</option>
                    <option value="fallback">Fallback to primary if set display is undetected</option>
                  </select>
                </div>
              </div>

              <div class="tab-col">
                <div id="retry-fields-container" class="input-group">
                  <span class="select-label">Retry Settings:</span>
                  <div class="retry-fields">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                      <label style="font-size: 12px; color: #9aa0a6;">Interval (seconds)</label>
                      <input type="number" id="retry-interval" min="0.5" max="10" step="0.5" value="1">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                      <label style="font-size: 12px; color: #9aa0a6;">Max Retries</label>
                      <input type="number" id="max-retries" min="0" max="30" step="1" value="5">
                    </div>
                  </div>
                  <div style="margin-top: 8px;">
                    <span style="font-size: 12px; color: #9aa0a6;">Total Wait Time: </span>
                    <span id="total-wait" style="font-size: 14px; color: #007acc; font-weight: 500;">~5.0s</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <button id="devtools-btn" onclick="app.toggleDevTools()">DevTools</button>
    <button id="quit-btn" class="danger" onclick="app.quit()">Quit</button>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const app = {
      wsRunning: false,
      fullscreenMode: true,
      viewportOpen: false,
      localIps: [],
      displays: [],
      selectedDisplayId: 0,
      fpsPosition: 'top-left',
      currentTab: 'options',
      retryInterval: 1,
      maxRetries: 5,
      wsPort: 8081,
      monitorBehavior: 'wait',

      async init() {
        // Load preferences and displays
        try {
          const [version, fullscreen, hideCursor, autoStart, autoOpenViz, showFps, ips, displays, savedDisplayId, fpsPosition, startMinimized, retryInterval, maxRetries, wsPort, monitorBehavior] = await Promise.all([
            ipcRenderer.invoke('get-app-version'),
            ipcRenderer.invoke('get-fullscreen-preference'),
            ipcRenderer.invoke('get-hide-cursor-preference'),
            ipcRenderer.invoke('get-auto-start-ws-preference'),
            ipcRenderer.invoke('get-auto-open-viz-preference'),
            ipcRenderer.invoke('get-show-fps-preference'),
            ipcRenderer.invoke('get-local-ips'),
            ipcRenderer.invoke('get-displays'),
            ipcRenderer.invoke('get-display-preference'),
            ipcRenderer.invoke('get-fps-position-preference'),
            ipcRenderer.invoke('get-start-minimized-preference'),
            ipcRenderer.invoke('get-retry-interval-preference'),
            ipcRenderer.invoke('get-max-retries-preference'),
            ipcRenderer.invoke('get-ws-port-preference'),
            ipcRenderer.invoke('get-monitor-behavior-preference')
          ]);

          // Set version
          if (version) {
            document.getElementById('version-header').textContent = `v${version}`;
          }

          // Set preferences
          this.fullscreenMode = fullscreen;
          this.localIps = ips || [];
          this.fpsPosition = fpsPosition || 'top-left';
          this.retryInterval = retryInterval ?? 1;
          this.maxRetries = maxRetries ?? 5;
          this.wsPort = wsPort ?? 8081;
          this.monitorBehavior = monitorBehavior ?? 'wait';
          
          document.getElementById('hide-cursor').checked = hideCursor;
          document.getElementById('auto-start').checked = autoStart;
          document.getElementById('auto-open-viz').checked = autoOpenViz;
          document.getElementById('show-fps').checked = showFps;
          document.getElementById('start-minimized').checked = startMinimized;
          document.getElementById('retry-interval').value = this.retryInterval;
          document.getElementById('max-retries').value = this.maxRetries;
          document.getElementById('ws-port').value = this.wsPort;
          document.getElementById('monitor-behavior-select').value = this.monitorBehavior;

          // Setup displays
          this.displays = displays || [];
          this.populateDisplaySelect(savedDisplayId);

          // Update position selector
          this.updatePositionSelector();
          
          // Update total wait time
          this.updateTotalWaitTime();

          // Update retry fields visibility
          this.updateRetryFieldsVisibility();

          // Update mode button
          const modeBtn = document.getElementById('mode-btn');
          modeBtn.textContent = this.fullscreenMode ? 'Fullscreen' : 'Windowed';
          modeBtn.className = this.fullscreenMode ? 'active' : '';

          // Update connection status
          this.updateConnectionStatus();

          console.log('✅ Preferences loaded');
        } catch (err) {
          console.error('Failed to load preferences:', err);
        }

        // Setup WebSocket status listener
        ipcRenderer.on('ws-status', (_event, data) => {
          if (data.ok) {
            this.wsRunning = data.message.includes('started') || data.message.includes('already running');
            const btn = document.getElementById('ws-btn');
            btn.textContent = this.wsRunning ? 'Stop WebSocket Server' : 'Start WebSocket Server';
            
            // Update port field disabled state
            const portField = document.getElementById('ws-port');
            portField.disabled = this.wsRunning;
            
            if (data.ips) {
              this.localIps = data.ips;
              this.updateConnectionStatus();
            }
          }
          this.showToast(data.message, data.ok ? 'info' : 'error');
        });

        // Setup visualization window listeners
        ipcRenderer.on('visualization-opened', () => {
          this.viewportOpen = true;
          const btn = document.getElementById('viewport-btn');
          btn.textContent = 'Close ViewPort';
          btn.className = 'danger';
        });

        ipcRenderer.on('visualization-closed', () => {
          this.viewportOpen = false;
          const btn = document.getElementById('viewport-btn');
          btn.textContent = 'Open ViewPort';
          btn.className = '';
        });

        // Listen for display changes
        ipcRenderer.on('displays-changed', (_event, displays) => {
          this.displays = displays;
          this.populateDisplaySelect(this.selectedDisplayId);
        });
      },

      switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');

        this.currentTab = tabName;
      },

      updateConnectionStatus() {
        const indicator = document.getElementById('connection-indicator');
        const modeEl = document.getElementById('connection-mode');
        const addressEl = document.getElementById('connection-address');

        if (this.wsRunning && this.localIps.length > 0) {
          indicator.classList.add('active');
          modeEl.textContent = 'WebSocket';
          addressEl.textContent = this.localIps.map(ip => `${ip}:${this.wsPort}`).join(', ');
        } else {
          indicator.classList.remove('active');
          modeEl.textContent = 'WebSocket';
          addressEl.textContent = 'Not connected';
        }
      },

      updateRetryFieldsVisibility() {
        const retryFields = document.getElementById('retry-fields-container');
        if (this.monitorBehavior === 'wait') {
          retryFields.style.display = 'flex';
        } else {
          retryFields.style.display = 'none';
        }
      },

      populateDisplaySelect(savedDisplayId) {
        const select = document.getElementById('monitor-select');
        select.innerHTML = '';

        if (this.displays.length === 0) {
          const option = document.createElement('option');
          option.value = '0';
          option.textContent = 'Primary Display';
          select.appendChild(option);
          this.selectedDisplayId = 0;
          return;
        }

        // Check if saved display still exists
        const savedDisplayExists = this.displays.some(d => d.id === savedDisplayId);
        const displayToSelect = savedDisplayExists ? savedDisplayId : this.displays[0].id;

        this.displays.forEach((display, index) => {
          const option = document.createElement('option');
          option.value = display.id;
          
          let label = `Display ${index + 1}`;
          if (display.primary) {
            label += ' (Primary)';
          }
          label += ` - ${display.bounds.width}x${display.bounds.height}`;
          if (display.label) {
            label += ` - ${display.label}`;
          }
          
          option.textContent = label;
          select.appendChild(option);
        });

        select.value = displayToSelect;
        this.selectedDisplayId = displayToSelect;

        // If saved display no longer exists, save the new default
        if (!savedDisplayExists && savedDisplayId !== null) {
          ipcRenderer.send('save-display-preference', displayToSelect);
          this.showToast('Previous display unavailable, using primary display');
        }
      },

      updatePositionSelector() {
        document.querySelectorAll('.position-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.position === this.fpsPosition) {
            btn.classList.add('active');
          }
        });
      },

      updateTotalWaitTime() {
        const totalWait = this.retryInterval * this.maxRetries;
        document.getElementById('total-wait').textContent = `~${totalWait.toFixed(1)}s`;
      },

      setFpsPosition(position) {
        this.fpsPosition = position;
        this.updatePositionSelector();
        ipcRenderer.send('save-fps-position-preference', position);
        
        const labels = {
          'top-left': 'Top Left',
          'top-right': 'Top Right',
          'bottom-left': 'Bottom Left',
          'bottom-right': 'Bottom Right',
          'center': 'Center'
        };
        this.showToast(`FPS position: ${labels[position]}`);
      },

      showToast(msg, type = 'info') {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = msg;
        document.body.appendChild(toast);

        setTimeout(() => toast.remove(), 2800);
      },

      toggleWebSocket() {
        ipcRenderer.send(this.wsRunning ? 'stop-ws' : 'start-ws');
      },

      toggleMode() {
        this.fullscreenMode = !this.fullscreenMode;
        const btn = document.getElementById('mode-btn');
        btn.textContent = this.fullscreenMode ? 'Fullscreen' : 'Windowed';
        btn.className = this.fullscreenMode ? 'active' : '';
        
        ipcRenderer.send('save-fullscreen-preference', this.fullscreenMode);
        
        this.showToast(`Mode switched to ${this.fullscreenMode ? 'Fullscreen' : 'Windowed'}`);
      },

      toggleViewport() {
        if (this.viewportOpen) {
          ipcRenderer.send('close-visualization');
        } else {
          ipcRenderer.send('open-visualization', {
            fullscreen: this.fullscreenMode,
            hideCursor: document.getElementById('hide-cursor').checked,
            showFps: document.getElementById('show-fps').checked,
            displayId: this.selectedDisplayId,
            fpsPosition: this.fpsPosition,
            retryInterval: this.retryInterval,
            maxRetries: this.maxRetries,
            monitorBehavior: this.monitorBehavior
          });
        }
      },

      toggleDevTools() {
        ipcRenderer.send('toggle-devtools');
      },

      quit() {
        this.showToast('Quitting application...');
        setTimeout(() => {
          ipcRenderer.send('quit-app');
        }, 500);
      }
    };

    // Checkbox handlers with IPC
    document.getElementById('hide-cursor').addEventListener('change', (e) => {
      ipcRenderer.send('save-hide-cursor-preference', e.target.checked);
      app.showToast(`Hide cursor: ${e.target.checked ? 'enabled' : 'disabled'}`);
    });

    document.getElementById('auto-start').addEventListener('change', (e) => {
      ipcRenderer.send('save-auto-start-ws-preference', e.target.checked);
      app.showToast(`Auto-start WebSocket: ${e.target.checked ? 'enabled' : 'disabled'} (applies on next launch)`);
    });

    document.getElementById('auto-open-viz').addEventListener('change', (e) => {
      ipcRenderer.send('save-auto-open-viz-preference', e.target.checked);
      app.showToast(`Auto-open visualization: ${e.target.checked ? 'enabled' : 'disabled'}`);
    });

    document.getElementById('show-fps').addEventListener('change', (e) => {
      ipcRenderer.send('save-show-fps-preference', e.target.checked);
      app.showToast(`FPS display: ${e.target.checked ? 'enabled' : 'disabled'}`);
    });

    document.getElementById('start-minimized').addEventListener('change', (e) => {
      ipcRenderer.send('save-start-minimized-preference', e.target.checked);
      app.showToast(`Start minimized: ${e.target.checked ? 'enabled' : 'disabled'} (applies on next launch)`);
    });

    // Monitor select handler
    document.getElementById('monitor-select').addEventListener('change', (e) => {
      const displayId = parseInt(e.target.value);
      app.selectedDisplayId = displayId;
      ipcRenderer.send('save-display-preference', displayId);
      
      const selectedDisplay = app.displays.find(d => d.id === displayId);
      const displayName = selectedDisplay ? `Display ${app.displays.indexOf(selectedDisplay) + 1}` : 'selected display';
      app.showToast(`Viewport will open on ${displayName}`);
    });

    // Monitor behavior handler
    document.getElementById('monitor-behavior-select').addEventListener('change', (e) => {
      const value = e.target.value;
      app.monitorBehavior = value;
      app.updateRetryFieldsVisibility();
      ipcRenderer.send('save-monitor-behavior-preference', value);
      
      const label = value === 'wait' ? 'Wait for set display' : 'Fallback to primary if set display is undetected';
      app.showToast(`Multi-monitor behavior: ${label}`);
    });

    // Retry interval handler
    document.getElementById('retry-interval').addEventListener('change', (e) => {
      const value = parseFloat(e.target.value);
      if (value >= 0.5 && value <= 10) {
        app.retryInterval = value;
        app.updateTotalWaitTime();
        ipcRenderer.send('save-retry-interval-preference', value);
        app.showToast(`Retry interval: ${value}s`);
      }
    });

    // Max retries handler
    document.getElementById('max-retries').addEventListener('change', (e) => {
      const value = parseInt(e.target.value);
      if (value >= 0 && value <= 30) {
        app.maxRetries = value;
        app.updateTotalWaitTime();
        ipcRenderer.send('save-max-retries-preference', value);
        app.showToast(`Max retries: ${value}`);
      }
    });

    // WebSocket port handler
    document.getElementById('ws-port').addEventListener('change', (e) => {
      const value = parseInt(e.target.value);
      if (value >= 1024 && value <= 65535) {
        app.wsPort = value;
        ipcRenderer.send('save-ws-port-preference', value);
        app.showToast(`WebSocket port: ${value} (restart server to apply)`);
      }
    });

    // Initialize app
    app.init();
    console.log('✅ App UI loaded successfully');
  </script>
</body>
</html>