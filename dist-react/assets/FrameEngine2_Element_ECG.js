import{R as F,a as t,j as z}from"./visualization.js";const G=({properties:n,resolvedValues:y,width:u,height:o})=>{const A=t.useRef(null),C=t.useRef(null),s=t.useRef(null),x=t.useRef(!0),c=t.useRef([]),b=t.useRef(o/2),E=t.useRef(Date.now()),v=t.useRef(0),R=t.useRef(0),S=t.useRef({waveformColor:n.waveformColor,backgroundColor:n.backgroundColor,gridBackgroundColor:n.gridBackgroundColor,gridColor:n.gridColor,showGrid:n.showGrid,showBorder:n.showBorder,lineWidth:n.lineWidth,gridScrollSpeed:n.gridScrollSpeed,bufferSize:n.bufferSize,yAxisMin:n.yAxisMin,yAxisMax:n.yAxisMax}),T=30,i=20;C.current||(C.current=document.createElement("canvas")),t.useEffect(()=>{S.current={waveformColor:n.waveformColor,backgroundColor:n.backgroundColor,gridBackgroundColor:n.gridBackgroundColor,gridColor:n.gridColor,showGrid:n.showGrid,showBorder:n.showBorder,lineWidth:n.lineWidth,gridScrollSpeed:n.gridScrollSpeed,bufferSize:n.bufferSize,yAxisMin:n.yAxisMin,yAxisMax:n.yAxisMax}},[n]);const d=t.useMemo(()=>{if(!n.sensorTag||!y[n.sensorTag])return;const e=y[n.sensorTag].value;return typeof e=="number"?e:parseFloat(e)},[n.sensorTag,y]);t.useEffect(()=>{if(d==null||isNaN(d))return;const e=S.current,f=e.yAxisMax-e.yAxisMin,g=(d-e.yAxisMin)/f,r=Math.max(0,Math.min(1,g));b.current=o-r*o},[d,o]);const m=t.useCallback(()=>{if(!x.current)return;const e=A.current,f=C.current;if(!e||!f){s.current=requestAnimationFrame(m);return}const g=e.getContext("2d"),r=f.getContext("2d");if(!g||!r){s.current=requestAnimationFrame(m);return}const l=S.current,M=Date.now();if(M-E.current>=T&&(E.current=M,c.current.push(b.current),c.current.length>l.bufferSize&&c.current.shift(),v.current=(v.current+1)%u,R.current+=l.gridScrollSpeed,R.current>=i&&(R.current-=i)),r.clearRect(0,0,u,o),r.fillStyle=l.backgroundColor,r.fillRect(0,0,u,o),l.showGrid&&l.gridBackgroundColor&&l.gridBackgroundColor!=="transparent"&&(r.fillStyle=l.gridBackgroundColor,r.fillRect(0,0,u,o)),l.showGrid){r.strokeStyle=l.gridColor,r.lineWidth=1;const k=-R.current;for(let a=k;a<u+i;a+=i)r.beginPath(),r.moveTo(a,0),r.lineTo(a,o),r.stroke();for(let a=0;a<o+i;a+=i)r.beginPath(),r.moveTo(0,a),r.lineTo(u,a),r.stroke()}if(c.current.length>1){r.strokeStyle=l.waveformColor,r.lineWidth=l.lineWidth,r.lineCap="round",r.lineJoin="round",r.beginPath();const k=c.current;k.forEach((a,w)=>{const B=w/(k.length-1)*u;w===0?r.moveTo(B,a):r.lineTo(B,a)}),r.stroke()}l.showBorder&&(r.strokeStyle=l.waveformColor,r.lineWidth=2,r.strokeRect(1,1,u-2,o-2)),g.clearRect(0,0,u,o),g.drawImage(f,0,0),x.current&&(s.current=requestAnimationFrame(m))},[u,o]);return t.useEffect(()=>{const e=S.current.bufferSize;if(c.current.length===0)c.current=Array(e).fill(o/2);else if(c.current.length<e){const f=c.current[c.current.length-1]||o/2;for(;c.current.length<e;)c.current.unshift(f)}else c.current.length>e&&(c.current=c.current.slice(-e))},[n.bufferSize,o]),t.useEffect(()=>{const e=C.current;if(e)return e.width=u,e.height=o,s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(m),()=>{s.current&&cancelAnimationFrame(s.current)}},[u,o,m]),t.useEffect(()=>(x.current=!0,()=>{x.current=!1,s.current&&(cancelAnimationFrame(s.current),s.current=null)}),[]),z.jsx("canvas",{ref:A,width:u,height:o,style:{width:"100%",height:"100%",display:"block"}})},_=F.memo(G);export{_ as default};
